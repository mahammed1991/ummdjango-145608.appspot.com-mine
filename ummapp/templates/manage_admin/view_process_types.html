{% extends 'manage_admin/admin_home.html' %}
{% load staticfiles %}
{% block content %}
{% if messages %}
<ul class="messages">
    {% for msg in messages %}       
    
        <div class="alert alert-{{msg.level_tag}}" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    {{msg.message}}
    </div>
    
    {% endfor %}
</ul>
{% endif %}
    <div class="alert alert-warning" role="alert" id="msg-info" style="display:none;">
        <button type="button" class="close" onclick="hideMsg()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <span id="span-msg"></span>
    </div>
    {{form.non_field_errors}}
    {% if update %}
    <form action="" method="post" name="process" id="process-type-update-form" class="form-horizontal" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="process-type" class="control-label col-sm-2">Process</label>
            <div class="col-sm-10">
                <select class="form-control" id="process" name="process">
                <option data-group='SHOW' value='0' id='0'>-- Select --</option>

                {% for process in processes %}
                <option id="{{ process.0 }}" value="{{ process.0 }}" {% if process.0  == form.process.value %}selected='selected'{% endif %} >{{ process.1 }}</option>
                {% endfor %}
                </select>
                {{ form.errors.process }}
            </div>
        </div>
        <div class="form-group">
            <label for="process-type" class="control-label col-sm-2">Quarter</label>
            <div class="col-sm-10">
                <select class="form-control" id="quarter" name="quarter">
                <option data-group='SHOW' value='0' id='0'>-- Select --</option>                     
                {% for quarter in quarters %}
                <option id="{{ quarter.0 }}" value="{{ quarter.0 }}" {% if quarter.1 == form.quarter.value %}selected='selected'{% endif %}>{{ quarter.1 }}</option>
                {% endfor %}
                </select>
                {{ form.errors.quarter }}
            </div>
        </div>
        <div class="form-group">
            <label for="process-type" class="control-label col-sm-2">Name</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="program-type" name="name" value="{{form.name.value}}">
                {{ form.errors.name }}
            </div>
        </div>
        <div class="form-group">
            <label for="is-disabled" class="control-label col-sm-2">Is disabled</label> 
            <div class="col-sm-10">
                <input id="is-disabled" name="is_disabled" type="checkbox" {% if form.is_disabled.value %}checked{% endif %}>
            </div>
        </div>
        <input type="submit" class="btn btn-primary add" ></input>
    </form>
    {% else %}
    <div class='table-responsive'>
        <table class="table table-bordered">
        <thead>
            <tr>
                <th>
                    Process
                </th>
                <th>
                    Quarter
                </th>
                <th>
                    Name
                </th>
                <th>
                    Is disabled
                </th>
                <th>
                    Action
                </th>
            </tr>
        </thead>
        {% if process_types %}
        {% for p in process_types %}
        <tr>
            <td>{{p.process.name}}</td>
            <td>{{p.quarter.quarter}}-{{p.quarter.quarter_year}}</td>
            <td>{{p.name}}</td>
            <td>{{p.is_disabled}}</td>
            <td>
                <a data-id='{{p.id}}' id='process_type_view_edit_{{p.id}}'  href="/umm/update-program-type/{{p.id}}" role="button" class="btn" data-toggle="modal">View/Edit</a>  
            </td>
        </tr>
        {% endfor %}
        {% endif %}
        </table>
    </div>
    {% endif %}
<script src="{% static 'manage_admin/js/jquery.min.js'%}"></script>
<script src="{% static 'manage_admin/js/common.js'%}"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.sidebar-nav li').removeClass('active');
    $('#view-program-type').attr('class','active');

    });
    var process_val = '{{form.process.value}}'
    if (process_val != ''){
        $("#process option[id=" + process_val + "]").attr("selected", "selected");
    }

    var quarter_val = '{{form.quarter.value}}'
    if (quarter_val != ''){
        $("#quarter option[id=" + quarter_val + "]").attr("selected", "selected");
    }
    $("form#process-type-update-form").submit(function (e) {
        e.preventdefault();
        var formData = new FormData();
        name = $('#program-type').val()
        process_selected = $('#process').val()
        quarter = $('#quarter').val()
        formData.append('process', process_selected);
        formData.append('quarter', quarter);
        formData.append('name', name);
        formData.append('is_disabled', $('#is-disabled').val());
        formData.append('csrfmiddlewaretoken', $("[name='csrfmiddlewaretoken']").val());
        $.ajax({
            url: '/umm/update-program-type/',
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                $('#process-type-update-form')[0].reset()
            },
            error: function(data){
              alert("Something went wrong, please try after some time");
            }
        })
        //}
    })
</script>
{% endblock %}